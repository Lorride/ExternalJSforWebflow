<script>

// Setting inital values on page for "Behov/kapasitet kalkulator"
document.getElementById("Input_oppsamlings_krav_1time").value = 50;
document.getElementById("Input_oppsamlings_krav_2time").value = 15;
document.getElementById("Input_pot_disp_per_sek_m2").value = 2;

document.getElementById("Input_oppsamlings_tak_1time").value = 60;
document.getElementById("Input_oppsamlings_fasade_1time").value = 40;
document.getElementById("Input_oppsamlings_tak_2time").value = 60;
document.getElementById("Input_oppsamlings_fasade_2time").value = 40;

document.getElementById("Output_kapasitet_per_oppsam_res").value = 81;
document.getElementById("Output_kapasitet_per_akvedukt").value = 5;

// Setting inital values on page for "Kost/nytte kalkulator"

// -- Forlenget Amorteringstid --
document.getElementById("Forlenget_amorteringstid_aar1").value = 25;
document.getElementById("Forlenget_amorteringstid_aar2").value = 30;

document.getElementById("Forlenget_amorteringstid_lonebelop1").value = 100000000;
document.getElementById("Forlenget_amorteringstid_lonebelop2").value = 100000000;

document.getElementById("Forlenget_amorteringstid_procent1").value = 5;
document.getElementById("Forlenget_amorteringstid_procent2").value = 5;

document.getElementById("Forlenget_amorteringstid_rentekost1").value = 5000000;
document.getElementById("Forlenget_amorteringstid_rentekost2").value = 5000000;

document.getElementById("Forlenget_amorteringstid_renteavdrag1").value = 6757377;
document.getElementById("Forlenget_amorteringstid_renteavdrag2").value = 6195375;

document.getElementById("Forlenget_amorteringstid_bedret_likviditet").value = 562002;

// -- Besparelse Lonerente --
document.getElementById("Besparelse_lonerente_lonebelop").value = 100000000;
document.getElementById("Besparelse_lonerente_procent").value = 0.25;
document.getElementById("Besparelse_lonerente_resultat").value = 250000;

// -- Bærekraftig bygning; attraktivitet som utleieobjekt --
//Anslag,  økte leieinntekter
document.getElementById("Anslag_okte_leieinntekter_leieinntekter").value = 5000000;
document.getElementById("Anslag_okte_leieinntekter_procent").value = 5;
document.getElementById("Anslag_okte_leieinntekter_resultat").value = 250000;

//Overvannshåndteringssystem
document.getElementById("Overvannshandteringssystem_fullverdi_sum").value =  100000000;
document.getElementById("Overvannshandteringssystem_forsikringspremie_procent").value = 0.05;
document.getElementById("Overvannshandteringssystem_forsikringspremie_delresultat").value = 50000;

document.getElementById("Overvannshandteringssystem_forsikringspremie_diffforsikpremieiprocent").value = 10;
document.getElementById("Overvannshandteringssystem_forsikringspremie_besparelse").value = 5000;
	
// -- Bærekraftig bygning; fangst av klimagasser mv --
//Differensiert eiendomsskatt
document.getElementById("Differensiert_eiendomsskatt_skattegrunnlag").value = 70000000;
document.getElementById("Differensiert_eiendomsskatt_skattesatsprocent1").value = 0.4;
document.getElementById("Differensiert_eiendomsskatt_skattesatsprocent2").value = 0.2;
document.getElementById("Differensiert_eiendomsskatt_eiendomsskatt1").value = 280000;
document.getElementById("Differensiert_eiendomsskatt_eiendomsskatt2").value = 140000;
document.getElementById("Differensiert_eiendomsskatt_resultat").value = 140000;
	
// Event listener for calculate button for "Behov/kapasitet kalkulator"
document.getElementById("calculate").addEventListener("click", simpleCalculation);

// Event listener for calculate button for "Kost/nytte kalkulator"
document.getElementById("KostNytteKalkulerKnapp").addEventListener("click", costCalculation);

// Calculation method for filling out fields based on inputs
function simpleCalculation() {
	var Input_Tomt_Areal = document.getElementById("Input_Tomt_Areal").value;
	var Input_oppsamlings_krav_1time = document.getElementById("Input_oppsamlings_krav_1time").value;
	var Input_oppsamlings_krav_2time = document.getElementById("Input_oppsamlings_krav_2time").value;
	var Oppsamlings_krav_1time = Input_Tomt_Areal * Input_oppsamlings_krav_1time;
	var Oppsamlings_krav_2time = Input_Tomt_Areal * Input_oppsamlings_krav_2time;
	
	document.getElementById("Output_oppsamlings_1time").value = Oppsamlings_krav_1time;
	document.getElementById("Output_oppsamlings_2time").value = Oppsamlings_krav_2time;
	
	var Input_pot_disp_per_sek_m2 = document.getElementById("Input_pot_disp_per_sek_m2").value / 1000;
	var Liter_per_time_paaslipp = Input_Tomt_Areal * Input_pot_disp_per_sek_m2 * 3600;
	document.getElementById("Output_liter_per_time_paaslipp").value = Liter_per_time_paaslipp;
	
	var Oppsamlings_behov_1time = Oppsamlings_krav_1time - Liter_per_time_paaslipp;
	var Oppsamlings_behov_2time = Oppsamlings_krav_2time - Liter_per_time_paaslipp;
	document.getElementById("Output_oppsamlings_behov_1time").value = Oppsamlings_behov_1time;
	document.getElementById("Output_oppsamlings_behov_2time").value = Oppsamlings_behov_2time;
	
	var Time1_oppsamling_tak_procent = 	document.getElementById("Input_oppsamlings_tak_1time").value;
	var Time1_oppsamling_fasade_procent = document.getElementById("Input_oppsamlings_fasade_1time").value;
	var Oppsamlings_tak_1time = (Time1_oppsamling_tak_procent / 100) * Oppsamlings_behov_1time;
	var Oppsamlings_fasade_1time = (Time1_oppsamling_fasade_procent / 100) * Oppsamlings_behov_1time;
	document.getElementById("Output_oppsamlings_tak_1time").value = Oppsamlings_tak_1time; 
	document.getElementById("Output_oppsamlings_fasade_1time").value = Oppsamlings_fasade_1time;
	
	var Time2_oppsamling_tak_procent = document.getElementById("Input_oppsamlings_tak_2time").value;	
	var Time2_oppsamling_fasade_procent = document.getElementById("Input_oppsamlings_fasade_2time").value;
	var Oppsamlings_tak_2time = (Time2_oppsamling_tak_procent / 100) * Oppsamlings_behov_2time; 
	var Oppsamlings_fasade_2time = (Time2_oppsamling_fasade_procent / 100) * Oppsamlings_behov_2time;
	document.getElementById("Output_oppsamlings_tak_2time").value = Oppsamlings_tak_2time;
	document.getElementById("Output_oppsamlings_fasade_2time").value = Oppsamlings_fasade_2time;			
	
	var Kapasitet_per_oppsam_res = document.getElementById("Output_kapasitet_per_oppsam_res").value;
	var Antall_oppsam_res = ( Oppsamlings_tak_1time + Oppsamlings_tak_2time ) / Kapasitet_per_oppsam_res;
	document.getElementById("Output_antall_oppsam_res").value = Antall_oppsam_res;
	
	var Kapasitet_per_akvedukt = document.getElementById("Output_kapasitet_per_akvedukt").value;
	var Behov_antall_akvedukt = ( Oppsamlings_fasade_1time + Oppsamlings_fasade_2time) / Kapasitet_per_akvedukt;
	document.getElementById("Output_behov_antall_akvedukt").value = Behov_antall_akvedukt;
}	

// Excel math-functions
function PVIF(rate, nper) {
	return Math.pow(1 + rate, nper);
}

function PMT(rate, nper, pv, fv, type) {
	if (!fv) fv = 0;
	if (!type) type = 0;

	if (rate == 0) return -(pv + fv)/nper;
		
	var pvif = Math.pow(1 + rate, nper);
	var pmt = rate / (pvif - 1) * -(pv * pvif + fv);

	if (type == 1) {
		pmt /= (1 + rate);
	}

	return pmt;
}

function IPMT(pv, pmt, rate, per) {
	var tmp = Math.pow(1 + rate, per);
	return 0 - (pv * tmp * rate + pmt * (tmp - 1));
}

function PPMT(rate, per, nper, pv, fv, type) {
    if (per < 1 || (per >= nper + 1)) return null;
	var pmt = PMT(rate, nper, pv, fv, type);
    var ipmt = IPMT(pv, pmt, rate, per - 1);
	return pmt - ipmt;
}

// Calculation method for filling out fields based on inputs
function costCalculation() {
    // -- Forlenget Amorteringstid --
    var Forlenget_amorteringstid_aar1 = document.getElementById("Forlenget_amorteringstid_aar1").value;
    var Forlenget_amorteringstid_aar2 = document.getElementById("Forlenget_amorteringstid_aar2").value;

    var Forlenget_amorteringstid_lonebelop1 = document.getElementById("Forlenget_amorteringstid_lonebelop1").value;
    var Forlenget_amorteringstid_lonebelop2 = document.getElementById("Forlenget_amorteringstid_lonebelop2").value;

    var Forlenget_amorteringstid_procent1 = document.getElementById("Forlenget_amorteringstid_procent1").value / 100;
    var Forlenget_amorteringstid_procent2 = document.getElementById("Forlenget_amorteringstid_procent2").value / 100;

    var Forlenget_amorteringstid_rentekost1 = document.getElementById("Forlenget_amorteringstid_rentekost1").value;
    var Forlenget_amorteringstid_rentekost2 = document.getElementById("Forlenget_amorteringstid_rentekost2").value;

    var Forlenget_amorteringstid_renteavdrag1 = document.getElementById("Forlenget_amorteringstid_renteavdrag1").value;
    var Forlenget_amorteringstid_renteavdrag2 = document.getElementById("Forlenget_amorteringstid_renteavdrag2").value;

    document.getElementById("Forlenget_amorteringstid_rentekost1").value = Math.round(Forlenget_amorteringstid_lonebelop1 * Forlenget_amorteringstid_procent1);
    document.getElementById("Forlenget_amorteringstid_rentekost2").value = Math.round(Forlenget_amorteringstid_lonebelop2 * Forlenget_amorteringstid_procent2);

    document.getElementById("Forlenget_amorteringstid_renteavdrag1").value = Math.round(PPMT(Forlenget_amorteringstid_procent1, Forlenget_amorteringstid_aar1, Forlenget_amorteringstid_aar1, Forlenget_amorteringstid_lonebelop1, 0, 0));
    document.getElementById("Forlenget_amorteringstid_renteavdrag2").value = Math.round(PPMT(Forlenget_amorteringstid_procent2, Forlenget_amorteringstid_aar2, Forlenget_amorteringstid_aar2, Forlenget_amorteringstid_lonebelop2, 0, 0));

    document.getElementById("Forlenget_amorteringstid_bedret_likviditet").value = document.getElementById("Forlenget_amorteringstid_renteavdrag1").value - document.getElementById("Forlenget_amorteringstid_renteavdrag2").value;

    // -- Besparelse Lånerente --
    var Besparelse_lonerente_lonebelop = document.getElementById("Besparelse_lonerente_lonebelop").value;
    var Besparelse_lonerente_procent = document.getElementById("Besparelse_lonerente_procent").value / 100;
    var Besparelse_lonerente_resultat = Math.round(Besparelse_lonerente_lonebelop * Besparelse_lonerente_procent);
    
    document.getElementById("Besparelse_lonerente_resultat").value = Besparelse_lonerente_resultat;

    // -- Bærekraftig bygning; attraktivitet som utleieobjekt --
    // Anslag,  økte leieinntekter
    var Anslag_okte_leieinntekter_leieinntekter = document.getElementById("Anslag_okte_leieinntekter_leieinntekter").value;
    var Anslag_okte_leieinntekter_procent = (document.getElementById("Anslag_okte_leieinntekter_procent").value / 100);
    var Anslag_okte_leieinntekter_resultat = Math.round(Anslag_okte_leieinntekter_leieinntekter * Anslag_okte_leieinntekter_procent);

    document.getElementById("Anslag_okte_leieinntekter_resultat").value = Anslag_okte_leieinntekter_resultat;

    // Overvannshåndteringssystem
    var Overvannshandteringssystem_fullverdi_sum = document.getElementById("Overvannshandteringssystem_fullverdi_sum").value;
    var Overvannshandteringssystem_forsikringspremie_procent = document.getElementById("Overvannshandteringssystem_forsikringspremie_procent").value / 100;
    var Overvannshandteringssystem_forsikringspremie_delresultat = Math.round(Overvannshandteringssystem_fullverdi_sum*Overvannshandteringssystem_forsikringspremie_procent);

    document.getElementById("Overvannshandteringssystem_forsikringspremie_delresultat").value = Overvannshandteringssystem_forsikringspremie_delresultat;

    var Overvannshandteringssystem_forsikringspremie_diffforsikpremieiprocent = document.getElementById("Overvannshandteringssystem_forsikringspremie_diffforsikpremieiprocent").value / 100;
    var Overvannshandteringssystem_forsikringspremie_besparelse = Math.round(Overvannshandteringssystem_forsikringspremie_diffforsikpremieiprocent * Overvannshandteringssystem_forsikringspremie_delresultat);

    document.getElementById("Overvannshandteringssystem_forsikringspremie_besparelse").value = Overvannshandteringssystem_forsikringspremie_besparelse;
	
    // -- Bærekraftig bygning; fangst av klimagasser mv --
    //Differensiert eiendomsskatt
    var Differensiert_eiendomsskatt_skattegrunnlag = document.getElementById("Differensiert_eiendomsskatt_skattegrunnlag").value;
	var Differensiert_eiendomsskatt_skattesatsprocent1 = document.getElementById("Differensiert_eiendomsskatt_skattesatsprocent1").value / 100;
	var Differensiert_eiendomsskatt_skattesatsprocent2 = document.getElementById("Differensiert_eiendomsskatt_skattesatsprocent2").value / 100;	
	
	var Differensiert_eiendomsskatt_eiendomsskatt1 = Math.round(Differensiert_eiendomsskatt_skattegrunnlag * Differensiert_eiendomsskatt_skattesatsprocent1);
	document.getElementById("Differensiert_eiendomsskatt_eiendomsskatt1").value = Differensiert_eiendomsskatt_eiendomsskatt1;
	
	var Differensiert_eiendomsskatt_eiendomsskatt2 = Math.round(Differensiert_eiendomsskatt_skattegrunnlag * Differensiert_eiendomsskatt_skattesatsprocent2);
	document.getElementById("Differensiert_eiendomsskatt_eiendomsskatt2").value = Differensiert_eiendomsskatt_eiendomsskatt2;
		
	var Differensiert_eiendomsskatt_resultat = Differensiert_eiendomsskatt_eiendomsskatt1 - Differensiert_eiendomsskatt_eiendomsskatt2;
	document.getElementById("Differensiert_eiendomsskatt_resultat").value = Differensiert_eiendomsskatt_resultat;
}

</script>
